<script>
(function() {
  // Root element that holds the theme classes
  const root = document.documentElement;

  // Apply a theme by adding/removing the appropriate class
  const applyTheme = (mode) => {
    if (mode === 'dark') {
      root.classList.add('theme-dark');
      root.classList.remove('theme-light');
    } else {
      root.classList.add('theme-light');
      root.classList.remove('theme-dark');
    }
    localStorage.setItem('color-theme', mode);
  };

  // Initialize: prefer saved choice, else system preference
  const saved = localStorage.getItem('color-theme');
  if (saved === 'dark' || saved === 'light') {
    applyTheme(saved);
  } else {
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(prefersDark ? 'dark' : 'light');
  }

  // React to system changes when user hasn't locked a choice
  const mql = window.matchMedia('(prefers-color-scheme: dark)');
  if (mql && typeof mql.addEventListener === 'function') {
    mql.addEventListener('change', (e) => {
      if (!localStorage.getItem('color-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  } else if (mql && typeof mql.addListener === 'function') {
    mql.addListener((e) => {
      if (!localStorage.getItem('color-theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }
})();
</script>